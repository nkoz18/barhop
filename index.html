<!DOCTYPE html>
<html lang="en">
<head>
  <!--
  =========================  HOOCH‚ÄôS HAUTE-TAKES ‚Äî GUIDE (not rendered)  =========================

  Section name
  Hooch‚Äôs Haute-Takes

  Image filename
  hooch_critic.png

  Paw scale (use paws as stars)
  5 üêæüêæüêæüêæüêæ ‚Äî Full-Body Zoomies: White-glove for the white floof‚Äîinstant woo-woo.
  4 üêæüêæüêæüêæ ‚Äî Big Tail Wags: Sniff-approved; one tiny grr from perfection.
  3 üêæüêæüêæ ‚Äî Polite Sit: Good dog, good grub; not a destination snout.
  2 üêæüêæ ‚Äî Side-Eye Sniff: Treats try; vibe shy.
  1 üêæ ‚Äî Low Growl: Would not boop again.
  0 ‚Äî Cone of Shame: Only if you forgot your nose at home.

  Review section headers
  Sniff Test ¬∑ Chow Down ¬∑ Pup Perks ¬∑ Pack Vibe ¬∑ Haute-Take ¬∑ Tail Tally

  Reusable voice lines / lexicon
  haute hound ‚Ä¢ fine-dining floof ‚Ä¢ snow-sommelier
  snoot-vetted ‚Ä¢ boop-worthy ‚Ä¢ sniff-approved ‚Ä¢ tail-verified
  zoomie-inducing ‚Ä¢ big floof energy ‚Ä¢ good-boy gastronomy
  patio paw-lor ‚Ä¢ water bowl sommelier ‚Ä¢ chef‚Äôs chews
  snoot-to-table ‚Ä¢ chonk-worthy portions ‚Ä¢ cold-weather cred

  Handy sentence starters
  ‚ÄúPerimeter patrol complete‚Äîpatio is boop-worthy.‚Äù
  ‚ÄúWater arrived pre-chilled; the snow-sommelier approves.‚Äù
  ‚ÄúFries pass the no-droop test; burger earns a two-paw lift.‚Äù
  ‚ÄúStaff delivered unsolicited scritches‚Äînoted.‚Äù
  ‚ÄúNoise is busy-brunch, not leaf-blower‚Äîdignified floof zone.‚Äù
  ‚ÄúAromas do synchronized zoomies: buttery grill, basil, faint fryer fizz.‚Äù

  Closers
  ‚ÄúHaute-Take: woo-woo worth the walk.‚Äù
  ‚ÄúTail Tally: X/5 üêæ ‚Äî why: one short clause.‚Äù
  ‚ÄúSnoot says: return with the pack.‚Äù
  ===============================================================================================
  -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leah's Birthday Bar Hop!</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <!-- Icons + Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root {
      --rose-700:#be123c;
      --rose-600:#e11d48; /* better contrast than pink-500 */
      --rose-500:#f43f5e;
      --rose-300:#fda4af;
      --rose-200:#fecdd3;
      --bg:#fff1f2;       /* soft rose background */
    }

    html, body { height:100%; scroll-behavior: smooth; }
    body { font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:#1f2937; }
    .birthday-header { font-family:'Pacifico', cursive; color:var(--rose-600); }

    /* Map + popups */
    #map {
      height: clamp(360px, 62vh, 640px);
      border-radius: .9rem; border:3px solid var(--rose-200);
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);
    }
    .leaflet-container a { color:var(--rose-600); }
    .leaflet-popup-content-wrapper { border-radius:.75rem; border:2px solid var(--rose-600); }
    .leaflet-popup-content {
      margin:.85rem;
      max-width:min(86vw, 380px);
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size:.98rem; line-height:1.5;
    }
    .popup-title { font-weight:800; font-size:1.1rem; color:#111827; }
    .popup-section-title { font-weight:700; color:#111827; margin-top:.35rem; }
    .custom-marker {
      text-align:center; color:var(--rose-600); font-size:1.9rem; line-height:1;
      text-shadow:0 0 5px rgba(255,255,255,.7);
    }

    /* List items */
    .list-item { border:1px solid rgba(244,63,94,.15); }
    .list-item:hover { background:#ffe4e6; transform:translateX(3px); transition:all .15s ease-in-out; }
    .list-item[aria-current="true"] { background:#ffe4e6; border-color:var(--rose-500); box-shadow:0 0 0 2px rgba(244,63,94,.35) inset; }

    /* Confetti (subtle) */
    .confetti { position:fixed; width:10px; height:10px; opacity:.6; animation:confetti-fall 6s linear infinite;
                border-radius:50%; top:-20px; z-index:0; pointer-events:none; }
    @keyframes confetti-fall { 0%{transform:translateY(0) rotate(0)} 100%{transform:translateY(110vh) rotate(720deg)} }
    @media (prefers-reduced-motion: reduce) { .confetti { animation:none !important; display:none !important; } }

    /* Badges + links */
    .badge { display:inline-flex; align-items:center; gap:.45rem; padding:.18rem .55rem; border-radius:9999px;
             background:#ffe4e6; color:var(--rose-700); font-weight:700; font-size:.78rem; }
    .popup-links a { text-decoration:underline; }

    /* Hooch critic visuals ‚Äî make icon & paws nice and big */
    .hooch-row img, .hooch-icon img { box-shadow:0 1px 2px rgb(0 0 0 / .15); }
    .hooch-icon img { width:64px; height:64px; }            /* ~2x larger */
    .paws { font-size:1.9rem; line-height:1; }              /* ~2x larger */
    .paws--mini { font-size:1.35rem; line-height:1; }       /* bigger in sidebar too */

    /* Layout polish: remove nested scrollbars and make sidebar sticky on desktop */
    .aside-card { background:rgba(255,255,255,.9); backdrop-filter:blur(6px); }
    @media (min-width:1024px) {
      .aside-wrap { position: sticky; top: 1rem; }
    }
  </style>
</head>
<body>
  <!-- Confetti -->
  <div id="confetti-container" aria-hidden="true"></div>

  <!-- Compact top header with circular portrait -->
  <header class="container mx-auto px-4 sm:px-8 pt-6 pb-6 mb-4">
    <div class="flex flex-col sm:flex-row items-center sm:items-end gap-4 sm:gap-6">
      <!-- Circular portrait -->
      <div class="relative w-32 h-32 sm:w-40 sm:h-40 rounded-full ring-4 ring-[var(--rose-200)] shadow-lg overflow-hidden shrink-0">
        <img
          src="./leah.jpg"
          alt="Leah smiling‚Äîbirthday portrait"
          class="absolute inset-0 w-full h-full object-cover"
          loading="eager"
          onerror="this.src='https://picsum.photos/400?blur=3';"
          referrerpolicy="no-referrer"
        />
      </div>

      <div class="text-center sm:text-left">
        <div class="flex items-center justify-center sm:justify-start gap-3">
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
          <h1 class="birthday-header text-4xl sm:text-5xl">Happy Birthday, Leah!</h1>
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
        </div>

        <p class="mt-2 text-gray-800 font-semibold">Operation: Birthday Bar Hop</p>

        <p class="text-gray-700">
          Celebrate our favorite structural engineer with the Ockley Green Renegades‚ÄîNikita, Mindy &amp; Keith, Linnea &amp; Aaron (+ sports &amp; languages), and Monica the dog whisperer!
          We‚Äôll try not to <em>bark</em> up the wrong bar‚ÄîHooch, Osho, Luna &amp; Appa expect <strong>pawsitive</strong> updates. üêæ
        </p>

        <!-- Plan notes (start + suggestions) -->
        <div class="mt-3 flex flex-wrap gap-2">
          <span class="badge"><i class="fa-solid fa-location-dot"></i> Tentative start: <strong>Angel Face</strong></span>
          <span class="badge"><i class="fa-regular fa-clock"></i> 6:30 or 7:00 pm ‚Äî flexible</span>
          <span class="badge"><i class="fa-regular fa-lightbulb"></i> These are suggestions‚Äîplease throw out options!</span>
        </div>

        <!-- Aviation quest note -->
        <div class="mt-3">
          <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-Adjacent Quest</span>
          <span class="ml-2 text-sm text-gray-700">
            Hunting cocktails with gin + maraschino/elderflower + lemon vibes for Leah (snow-sommelier approved).
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="container mx-auto px-4 sm:px-8 pt-2 pb-10 relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 order-1">
        <div id="map" aria-label="Map of bar hop locations"></div>
        <p class="mt-2 text-xs text-gray-600">Tip: tap a marker or pick a spot from the list.</p>
      </div>

      <aside class="order-2 aside-wrap">
        <div class="aside-card p-4 rounded-xl shadow-lg border border-rose-200">
          <h2 class="text-2xl font-extrabold mb-3 border-b-2 border-rose-200 pb-2 text-[var(--rose-600)]">The Hot Spots</h2>
          <ul id="bar-list" class="space-y-2"></ul>
          <div class="mt-4 text-xs text-gray-600">
            <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>
            picks are flagged where applicable. Links open new tabs.
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ---- Confetti (subtle) ----
    (function () {
      const c = document.getElementById('confetti-container');
      const colors = ['#f43f5e', '#fecdd3', '#fde68a', '#a78bfa'];
      for (let i = 0; i < 50; i++) {
        const dot = document.createElement('div');
        dot.className = 'confetti';
        dot.style.left = `${Math.random() * 100}vw`;
        dot.style.animationDelay = `${Math.random() * 5}s`;
        dot.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        dot.style.transform = `scale(${Math.random() * 0.55 + 0.55})`;
        c.appendChild(dot);
      }
    })();

    // ---- Link helpers (prefer canonical; fall back to robust searches) ----
    const toMapsLatLng = (lat,lng) => `https://www.google.com/maps?q=${lat},${lng}`;
    const toMenuSearch = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' menu Portland')}`;
    const toInstaSearch = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' Instagram Portland')}`;

    // ---- Accessible paws renderer (big paws) ----
    function renderPaws(rating = 0, mini = false) {
      rating = Math.max(0, Math.min(5, rating));
      const cls = mini ? 'paws paws--mini' : 'paws';
      let full = 'üêæ'.repeat(rating);
      let empty = 'üêæ'.repeat(5 - rating).split('').map(p => `<span class="opacity-30">${p}</span>`).join('');
      return `<span class="${cls}" aria-label="${rating} out of 5 paws"><span aria-hidden="true">${full}${empty}</span></span>`;
    }

    // ---- Bars (from your DATA), plus personal touches + Hooch's Haute-Takes per bar ----
    const bars = [
      {
        name: "Angel Face",
        vibe: "European-style, intimate, alluring; no printed menu‚Äîtell the bartender your vibe and they engineer something structurally sound for Leah.",
        lat: 45.5232, lng: -122.6371,
        instagramUrl: "https://www.instagram.com/angelfaceportland/",
        menuUrl: "https://www.angelfaceportland.com/pages/menu",
        distanceMi: 3.4,
        aviationAdj: true,
        hoochReview: {
          rating: 5, verdict: "Full-Body Zoomies",
          sniff: "Juniper breeze, violet whisper, fizz like fresh snow.",
          chow: "Steak frites earn a two-paw lift; oysters boop back.",
          perks: "Zero-proof bespoke on request; water bowl sommelier present.",
          vibe: "Hand-painted roses + hush = dignified floof zone.",
          haute: "Snoot-to-table cocktailing‚Äîwoo-woo worth the walk.",
          why: "bespoke magic + cozy perch"
        }
      },
      {
        name: "Deadshot",
        vibe: "Avant-garde sips with clever chemistry‚Äîperfect for Mindy & Keith to flex those roaster palates while the pack debates if mustard belongs in glasses.",
        lat: 45.5074, lng: -122.6548,
        instagramUrl: "https://www.instagram.com/deadshotpdx/",
        menuUrl: "https://www.deadshotpdx.com/menu",
        distanceMi: 4.2,
        aviationAdj: false,
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Bitters lab; citrus, spice, and curiosity.",
          chow: "Smart snacks pass the no-droop test.",
          perks: "Bartenders riff zero-proof on cue.",
          vibe: "Cocktail nerd HQ‚ÄîAaron can order in three languages.",
          haute: "For adventurous snoots; bring your science goggles.",
          why: "inventive but niche"
        }
      },
      {
        name: "Driftwood Room",
        vibe: "1950s velvet hideaway in the Hotel deLuxe; moody, glamorous, and tailor-made for plotting winter-sport shenanigans.",
        lat: 45.5208, lng: -122.6878,
        instagramUrl: "https://www.instagram.com/hotel_deluxe/",
        menuUrl: "https://www.hoteldeluxe.com/dining/driftwood-room/driftwood-menu/",
        distanceMi: 3.3,
        aviationAdj: true,
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Elderflower lift with a grapefruit glow‚Äîsniff-approved.",
          chow: "Olives classy; fries crisp like fresh groomers.",
          perks: "Sparkly zero-proof riffs available.",
          vibe: "Retro lounge; TV sightlines mercifully minimal (sorry, Aaron).",
          haute: "Classic room, tail-verified.",
          why: "floral fizz + plush booths"
        }
      },
      {
        name: "Expatriate",
        vibe: "Atmospheric, freewheeling; Naomi & Kyle power combo. Legendary nachos = pack fuel; Leah-level balance in the glass.",
        lat: 45.5624, lng: -122.6346,
        instagramUrl: "https://www.instagram.com/expatriatepdx/",
        menuUrl: "http://expatriatepdx.com/cocktails",
        distanceMi: 2.2,
        aviationAdj: true,
        hoochReview: {
          rating: 5, verdict: "Full-Body Zoomies",
          sniff: "Citrus & spice do synchronized zoomies.",
          chow: "Wonton nachos are chonk-worthy portions.",
          perks: "House shrubs for the zero-proof crew.",
          vibe: "Dim, vibey, playlist snout-vetted.",
          haute: "Big floof energy‚Äîinstant woo-woo.",
          why: "power snacks + elderflower"
        }
      },
      {
        name: "Function NE",
        vibe: "Rotating breweries pop-up; perfect for curiosity laps and ‚Äòwho brought the pretzels?‚Äô debates.",
        lat: 45.5590, lng: -122.6448,
        instagramUrl: "https://www.instagram.com/functionpdx/",
        menuUrl: "https://untappd.com/v/function-ne/12485099",
        distanceMi: 1.7,
        aviationAdj: false,
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Hop field breeze; occasional cider orchard cameo.",
          chow: "Snacks vary‚Äîsnoot suggests pre-game bites.",
          perks: "Usually cider/kombucha/NA cans on deck.",
          vibe: "Alberta stroll energy; pack mingles easy.",
          haute: "Snoot-vetted variety pit stop.",
          why: "rotating taps + options"
        }
      },
      {
        name: "Hey Love",
        vibe: "Indoor jungle party inside a hotel lobby‚Äîtransportive, tropical, and dangerously crushable.",
        lat: 45.5228, lng: -122.6562,
        instagramUrl: "https://www.instagram.com/heylovepdx/",
        menuUrl: "https://www.heylovepdx.com/dinner",
        distanceMi: 3.2,
        aviationAdj: false,
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Passionfruit fireworks; basil confetti.",
          chow: "Tiki-ish bites pass the two-paw lift.",
          perks: "Deep zero-proof list; frozen fun for all.",
          vibe: "Plant jungle‚ÄîAppa would approve the foliage.",
          haute: "Vacation-in-a-glass; sand not included.",
          why: "playful menu; sweet-leaning"
        }
      },
      {
        name: "Moloko",
        vibe: "Modern mood lighting courtesy of coral reef aquariums‚ÄîLuna‚Äôs stealth camo zone; teacher-approved decompression for Linnea.",
        lat: 45.5518, lng: -122.6763,
        instagramUrl: "https://www.instagram.com/molokopdx/",
        menuUrl: "https://www.molokopdx.com/menu-page",
        distanceMi: 1.1,
        aviationAdj: true,
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Lavender breeze with lemon zings; snow-sommelier nod.",
          chow: "Small plates keep tails wagging.",
          perks: "NA cocktails on-menu; bartenders riff well.",
          vibe: "Purple glow = cozy den for the pack.",
          haute: "Moody nook for whisper-woo.",
          why: "floral spritz + hideaway"
        }
      },
      {
        name: "Roadside Attraction",
        vibe: "Quirky time capsule: ‚Äòkeep Portland weird‚Äô with fire pits, vintage clutter, and patio paw-lor vibes.",
        lat: 45.5160, lng: -122.6535,
        instagramUrl: "https://www.instagram.com/roadsideattractionpdx/",
        menuUrl: "http://places.singleplatform.com/roadside-attraction/menu",
        distanceMi: 3.6,
        aviationAdj: false,
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Campfire + citrus; faint fryer fizz.",
          chow: "Poppers vanish‚Äîtwo-paw lift confirmed.",
          perks: "Classic coolers; low-pretension paradise.",
          vibe: "Outdoor oddities = story fuel for days.",
          haute: "Weird in the good way.",
          why: "fire pits + lore"
        }
      },
      {
        name: "Slammer Tavern",
        vibe: "String lights, strong pours, zero pretense‚Äîwhere Nikita saves money for extra rounds and Aaron practices polyglot toasts.",
        lat: 45.5191, lng: -122.6574,
        instagramUrl: "https://www.instagram.com/slammertavern/",
        menuUrl: "http://places.singleplatform.com/slammers-16/menu",
        distanceMi: 3.4,
        aviationAdj: false,
        hoochReview: {
          rating: 2, verdict: "Side-Eye Sniff",
          sniff: "Peanuts, jukebox nostalgia, and cheap thrills.",
          chow: "Chips dependable; hot food situational.",
          perks: "Sodas that bite back for the NA crew.",
          vibe: "No-frills dive‚Äîbring your own inside jokes.",
          haute: "Wallet-friendly howl stop.",
          why: "cheap & cheerful; limited NA"
        }
      },
      {
        name: "Scotch Lodge",
        vibe: "Vintage-chic whiskey temple‚Äîhalf pours = engineering-grade sampling protocol for Leah‚Äôs inner nerd.",
        lat: 45.5214, lng: -122.6569,
        instagramUrl: "https://www.instagram.com/scotchlodge/",
        menuUrl: "https://www.scotchlodge.com/menus",
        distanceMi: 3.2,
        aviationAdj: false,
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Oak, honey, citrus; aromatics do orderly zoomies.",
          chow: "Savory bites keep the pack marching.",
          perks: "Thoughtful zero-proof options; half pours galore.",
          vibe: "Quiet flex; librarians of whiskey.",
          haute: "Tail-verified temple of grain.",
          why: "excellent pours + calm vibe"
        }
      }
    ];

    // ---- Map ----
    const map = L.map('map', { zoomControl: true }).setView([45.53, -122.65], 12.4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 20
    }).addTo(map);

    const barList = document.getElementById('bar-list');

    const cocktailIcon = L.divIcon({
      html: '<i class="fa-solid fa-martini-glass-citrus custom-marker"></i>',
      className: '', iconSize: [24,24], iconAnchor: [12,24], popupAnchor: [0,-24]
    });

    const group = L.featureGroup();
    const listItemByName = new Map();
    let activeName = null;

    const makePopupLinks = (bar) => {
      const m = bar.menuUrl || toMenuSearch(bar.name);
      const i = bar.instagramUrl || toInstaSearch(bar.name);
      const g = toMapsLatLng(bar.lat, bar.lng);
      return `
      <div class="popup-links flex flex-wrap items-center gap-3 mt-2 text-sm">
        <a target="_blank" rel="noopener" href="${m}">Menu</a>
        <span class="text-gray-400" aria-hidden="true">¬∑</span>
        <a target="_blank" rel="noopener" href="${i}">Instagram</a>
        <span class="text-gray-400" aria-hidden="true">¬∑</span>
        <a target="_blank" rel="noopener" href="${g}">Google Maps</a>
      </div>`;
    };

    // Build Hooch‚Äôs Haute-Takes section for a popup (icon & paws bigger)
    function hoochSection(bar) {
      const r = bar.hoochReview;
      if (!r) return '';
      return `
        <div class="mt-3">
          <div class="popup-section-title flex items-center gap-3">
            <span class="hooch-icon inline-flex items-center justify-center">
              <img src="./hooch_critic.png" alt="Hooch the Husky ‚Äî house critic" class="rounded-full ring-2 ring-[var(--rose-200)]">
            </span>
            <span>Hooch‚Äôs Haute-Takes</span>
            <span class="ml-auto text-sm font-semibold text-gray-800">${r.verdict}</span>
            ${renderPaws(r.rating, false)}
          </div>
          <div class="mt-1 text-sm text-gray-800 leading-5">
            <div><span class="font-semibold">Sniff Test:</span> ${r.sniff}</div>
            <div><span class="font-semibold">Chow Down:</span> ${r.chow}</div>
            <div><span class="font-semibold">Pup Perks:</span> ${r.perks}</div>
            <div><span class="font-semibold">Pack Vibe:</span> ${r.vibe}</div>
            <div><span class="font-semibold">Haute-Take:</span> ${r.haute}</div>
            <div><span class="font-semibold">Tail Tally:</span> ${r.rating}/5 üêæ ‚Äî why: ${r.why}.</div>
          </div>
        </div>`;
    }

    function hoochMiniLine(bar) {
      if (!bar.hoochReview) return '';
      return `
        <div class="mt-1 text-[12.5px] text-gray-700 flex items-center gap-2">
          <img src="./hooch_critic.png" alt="" class="w-8 h-8 rounded-full ring-1 ring-[var(--rose-200)]" aria-hidden="true">
          <span class="font-medium">${bar.hoochReview.verdict}</span>
          ${renderPaws(bar.hoochReview.rating, true)}
        </div>`;
    }

    function setActive(name) {
      if (activeName && listItemByName.get(activeName)) {
        listItemByName.get(activeName).setAttribute('aria-current','false');
      }
      const li = listItemByName.get(name);
      if (li) {
        li.setAttribute('aria-current','true');
        li.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      }
      activeName = name;
    }

    // Render markers + sidebar list
    bars.forEach(bar => {
      const coords = [bar.lat, bar.lng];
      const marker = L.marker(coords, { icon: cocktailIcon }).addTo(map);

      const popup = `
        <div>
          <div class="flex items-center gap-2">
            <h3 class="popup-title">${bar.name}</h3>
            ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>' : ''}
          </div>
          <p class="mt-1 text-gray-700">"${bar.vibe}"</p>

          ${hoochSection(bar)}

          <div class="mt-2 text-gray-800">
            <div class="popup-section-title">Links</div>
            ${makePopupLinks(bar)}
          </div>
        </div>`;
      marker.bindPopup(popup, { closeButton: true });
      group.addLayer(marker);

      // Sidebar list item
      const li = document.createElement('li');
      li.className = 'p-3 rounded-lg cursor-pointer list-item';
      li.innerHTML = `
        <div class="flex items-center justify-between">
          <span class="font-semibold">${bar.name}</span>
          <div class="flex items-center gap-2">
            ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Adj.</span>' : ''}
            <span class="text-[11px] text-gray-600">~${bar.distanceMi} mi from Ockley Green</span>
          </div>
        </div>
        ${hoochMiniLine(bar)}
        <div class="mt-1 text-xs text-gray-700">${bar.vibe}</div>
        <div class="mt-2 text-xs flex flex-wrap gap-2">
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.menuUrl || toMenuSearch(bar.name)}">Menu</a>
          <span class="text-gray-400">¬∑</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.instagramUrl || toInstaSearch(bar.name)}">Instagram</a>
          <span class="text-gray-400">¬∑</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${toMapsLatLng(bar.lat, bar.lng)}">Maps</a>
        </div>
      `;
      li.setAttribute('role','button');
      li.setAttribute('tabindex','0');
      li.setAttribute('aria-current','false');
      li.addEventListener('click', () => { map.flyTo(coords, 15, { duration:.6 }); marker.openPopup(); });
      li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.click(); }});
      barList.appendChild(li);
      listItemByName.set(bar.name, li);

      marker.on('popupopen', () => setActive(bar.name));
      marker.on('popupclose', () => {
        const current = listItemByName.get(bar.name);
        if (current) current.setAttribute('aria-current','false');
        if (activeName === bar.name) activeName = null;
      });
    });

    // Fit map to markers on load (good for mobile)
    map.whenReady(() => {
      if (group.getLayers().length) {
        map.fitBounds(group.getBounds().pad(0.12), { animate:false });
      }
    });
  </script>
</body>
</html>
