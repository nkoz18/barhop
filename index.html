<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leah's Birthday Bar Hop!</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <!-- Icons + Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root {
      --rose-600: #e11d48; /* better contrast than pink-500 */
      --rose-500: #f43f5e;
      --rose-200: #fecdd3;
      --bg: #fff1f2;       /* soft rose background */
    }
    html, body { height: 100%; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); color: #1f2937; }
    .birthday-header { font-family: 'Pacifico', cursive; color: var(--rose-600); }

    /* Map + popups */
    #map { height: 70vh; border-radius: .9rem; border:3px solid var(--rose-200);
           box-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1); }
    .leaflet-container a { color: var(--rose-600); }
    .leaflet-popup-content-wrapper { border-radius:.75rem; border:2px solid var(--rose-600); }
    .leaflet-popup-content {
      margin:.85rem;
      max-width:min(84vw, 340px);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: .95rem; line-height: 1.45;
    }
    .popup-title { font-weight: 800; font-size: 1.05rem; color:#111827; }
    .popup-section-title { font-weight: 600; color:#111827; margin-top:.25rem; }
    .custom-marker { text-align:center; color: var(--rose-600); font-size: 1.9rem; line-height:1;
                     text-shadow: 0 0 5px rgba(255,255,255,.7);}

    /* List items */
    .list-item { border:1px solid rgba(244,63,94,.15); }
    .list-item:hover { background:#ffe4e6; transform: translateX(3px); transition: all .15s ease-in-out; }
    .list-item[aria-current="true"] { background:#ffe4e6; border-color: var(--rose-500); box-shadow: 0 0 0 2px rgba(244,63,94,.35) inset; }

    /* Confetti (subtle) */
    .confetti { position: fixed; width:10px; height:10px; opacity:.6; animation: confetti-fall 6s linear infinite;
                border-radius:50%; top:-20px; z-index:0; pointer-events:none; }
    @keyframes confetti-fall { 0%{transform:translateY(0) rotate(0)} 100%{transform:translateY(110vh) rotate(720deg)} }
    @media (prefers-reduced-motion: reduce) {
      .confetti { animation: none !important; display: none !important; }
    }

    /* Small badge */
    .badge { display:inline-flex; align-items:center; gap:.4rem; padding:.15rem .5rem; border-radius:9999px;
             background:#ffe4e6; color:var(--rose-600); font-weight:600; font-size:.75rem; }

    /* Ensure links are clear in popups */
    .popup-links a { text-decoration: underline; }

    /* Hooch critic bits */
    .hooch-row img { box-shadow: 0 1px 2px rgb(0 0 0 / .15); }
  </style>
</head>
<body>
  <!-- Confetti -->
  <div id="confetti-container" aria-hidden="true"></div>

  <!-- Compact top header with circular portrait -->
  <header class="container mx-auto px-4 sm:px-8 pt-6 pb-6 mb-4">
    <div class="flex flex-col sm:flex-row items-center sm:items-end gap-4 sm:gap-6">
      <!-- Circular portrait -->
      <div class="relative w-32 h-32 sm:w-40 sm:h-40 rounded-full ring-4 ring-[var(--rose-200)] shadow-lg overflow-hidden shrink-0">
        <img
          src="./leah.jpg"
          alt="Leah smiling—birthday portrait"
          class="absolute inset-0 w-full h-full object-cover"
          loading="eager"
          onerror="this.src='https://picsum.photos/400?blur=3';"
          referrerpolicy="no-referrer"
        />
      </div>

      <div class="text-center sm:text-left">
        <div class="flex items-center justify-center sm:justify-start gap-3">
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
          <h1 class="birthday-header text-4xl sm:text-5xl">Happy Birthday, Leah!</h1>
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
        </div>

        <!-- Intro line: removed "Legendary" -->
        <p class="mt-2 text-gray-800 font-semibold">Operation: Birthday Bar Hop</p>

        <!-- First paragraph with dog joke + emoji -->
        <p class="text-gray-700">
          Celebrate our favorite structural engineer with the Ockley Green Renegades—Nikita, Monica, Mindy &amp; Keith, Linnea &amp; Aaron!
          We’ll try not to <em>bark</em> up the wrong bar—Hooch, Osho, Luna &amp; Appa expect <strong>pawsitive</strong> updates. 🐾
        </p>

        <p class="mt-2 text-sm text-gray-800 font-semibold bg-rose-100 border border-rose-200 rounded-lg px-2 py-1 inline-flex items-center gap-2">
          <i class="fa-solid fa-car-side"></i>
          Game Plan: Walk when we can; Lyft XL for the long hops (6 people).
          <i class="fa-solid fa-person-walking"></i>
        </p>

        <!-- Aviation quest note -->
        <div class="mt-3">
          <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-Adjacent Quest</span>
          <span class="ml-2 text-sm text-gray-700">
            Hunting cocktails with gin + maraschino + lemon + floral (violette or elderflower) vibes for Leah.
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="container mx-auto px-4 sm:px-8 pt-2 pb-6 relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 order-1">
        <div id="map" aria-label="Map of bar hop locations"></div>
        <p class="mt-2 text-xs text-gray-600">Tip: tap a marker or pick a spot from the list.</p>
      </div>

      <aside class="order-2">
        <div class="space-y-4">
          <!-- Hot Spots card -->
          <div class="bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-rose-200 max-h-[70vh] overflow-y-auto">
            <h2 class="text-2xl font-extrabold mb-3 border-b-2 border-rose-200 pb-2 text-[var(--rose-600)]">The Hot Spots</h2>
            <ul id="bar-list" class="space-y-2"></ul>
            <div class="mt-4 text-xs text-gray-600">
              <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>
              picks are flagged where applicable.
            </div>
          </div>

          <!-- Hooch’s Haute-Takes card (verbatim reference + quick scale) -->
          <section class="bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-rose-200">
            <div class="flex items-center gap-2">
              <img src="./hooch_critic.png" alt="Hooch the Husky — house critic" class="w-8 h-8 rounded-full ring-2 ring-[var(--rose-200)]">
              <h2 class="text-2xl font-extrabold text-[var(--rose-600)]">Hooch’s Haute-Takes</h2>
            </div>

            <!-- Compact in-page quick key for phones -->
            <div class="mt-3 text-sm text-gray-800">
              <div class="font-semibold">Paw scale (quick key)</div>
              <ul class="mt-1 list-disc ml-5 leading-6">
                <li><strong>5 🐾🐾🐾🐾🐾 — Full-Body Zoomies:</strong> White-glove for the white floof—instant woo-woo.</li>
                <li><strong>4 🐾🐾🐾🐾 — Big Tail Wags:</strong> Sniff-approved; one tiny grr from perfection.</li>
                <li><strong>3 🐾🐾🐾 — Polite Sit:</strong> Good dog, good grub; not a destination snout.</li>
                <li><strong>2 🐾🐾 — Side-Eye Sniff:</strong> Treats try; vibe shy.</li>
                <li><strong>1 🐾 — Low Growl:</strong> Would not boop again.</li>
                <li><strong>0 — Cone of Shame:</strong> Only if you forgot your nose at home.</li>
              </ul>
            </div>

            <!-- Full language & assets (verbatim) collapsible to keep mobile tidy -->
            <details class="mt-3">
              <summary class="cursor-pointer font-semibold text-[var(--rose-600)]">Language &amp; Assets (verbatim)</summary>
              <div class="mt-2 text-sm leading-6 text-gray-800">
                <p><strong>Section name</strong></p>
                <p><strong>Hooch’s Haute-Takes</strong></p>

                <p class="mt-2"><strong>Image filename</strong></p>
                <p><strong>hooch_critic.png</strong></p>

                <p class="mt-2"><strong>Paw scale (use paws as stars)</strong></p>
                <ul class="list-disc ml-5">
                  <li><strong>5 🐾🐾🐾🐾🐾 — Full-Body Zoomies:</strong> White-glove for the white floof—instant woo-woo.</li>
                  <li><strong>4 🐾🐾🐾🐾 — Big Tail Wags:</strong> Sniff-approved; one tiny grr from perfection.</li>
                  <li><strong>3 🐾🐾🐾 — Polite Sit:</strong> Good dog, good grub; not a destination snout.</li>
                  <li><strong>2 🐾🐾 — Side-Eye Sniff:</strong> Treats try; vibe shy.</li>
                  <li><strong>1 🐾 — Low Growl:</strong> Would not boop again.</li>
                  <li><strong>0 — Cone of Shame:</strong> Only if you forgot your nose at home.</li>
                </ul>

                <p class="mt-2"><strong>Review section headers</strong></p>
                <p><strong>Sniff Test · Chow Down · Pup Perks · Pack Vibe · Haute-Take · Tail Tally</strong></p>

                <p class="mt-2"><strong>Reusable voice lines / lexicon</strong></p>
                <p><em>haute hound • fine-dining floof • snow-sommelier<br>
                snoot-vetted • boop-worthy • sniff-approved • tail-verified<br>
                zoomie-inducing • big floof energy • good-boy gastronomy<br>
                patio paw-lor • water bowl sommelier • chef’s chews<br>
                snoot-to-table • chonk-worthy portions • cold-weather cred</em></p>

                <p class="mt-2"><strong>Handy sentence starters</strong></p>
                <ul class="list-disc ml-5">
                  <li>“Perimeter patrol complete—patio is <strong>boop-worthy</strong>.”</li>
                  <li>“Water arrived pre-chilled; the <strong>snow-sommelier</strong> approves.”</li>
                  <li>“Fries pass the <strong>no-droop test</strong>; burger earns a <strong>two-paw lift</strong>.”</li>
                  <li>“Staff delivered <strong>unsolicited scritches</strong>—noted.”</li>
                  <li>“Noise is <strong>busy-brunch</strong>, not <strong>leaf-blower</strong>—dignified floof zone.”</li>
                  <li>“Aromas do synchronized zoomies: buttery grill, basil, faint fryer fizz.”</li>
                </ul>

                <p class="mt-2"><strong>Closers</strong></p>
                <ul class="list-disc ml-5">
                  <li>“<strong>Haute-Take:</strong> woo-woo worth the walk.”</li>
                  <li>“<strong>Tail Tally:</strong> <em>X/5 🐾</em> — why: <em>one short clause</em>.”</li>
                  <li>“<strong>Snoot says:</strong> return with the pack.”</li>
                </ul>
              </div>
            </details>
          </section>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ---- Confetti (subtle) ----
    (function () {
      const c = document.getElementById('confetti-container');
      const colors = ['#f43f5e', '#fecdd3', '#fde68a', '#a78bfa'];
      for (let i = 0; i < 50; i++) {
        const dot = document.createElement('div');
        dot.className = 'confetti';
        dot.style.left = `${Math.random() * 100}vw`;
        dot.style.animationDelay = `${Math.random() * 5}s`;
        dot.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        dot.style.transform = `scale(${Math.random() * 0.55 + 0.55})`;
        c.appendChild(dot);
      }
    })();

    // ---- Link helpers (fallback to search; can be replaced by canonical URLs) ----
    const toMaps = (name) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name + ' Portland OR')}`;
    const toMenuSearch = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' Portland menu')}`;
    const toInstaSearch = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' Instagram Portland')}`;

    // ---- Accessible paws renderer ----
    function renderPaws(rating = 0) {
      rating = Math.max(0, Math.min(5, rating));
      let full = '🐾'.repeat(rating);
      let empty = '🐾'.repeat(5 - rating).split('').map(p => `<span class="opacity-30">${p}</span>`).join('');
      return `<span class="inline-flex items-center gap-1 align-middle" aria-label="${rating} out of 5 paws"><span aria-hidden="true">${full}${empty}</span></span>`;
    }

    // ---- Bars data + Hooch Critic reviews (inside jokes preserved) ----
    const bars = [
      {
        name: "Angel Face",
        vibe: "A fancy spot for our fancy engineer! The perfect place for an 'old lady' like Leah to enjoy a sophisticated, bespoke cocktail that's as structurally sound as her designs.",
        highlights: "<b>Bespoke Cocktails:</b> The main event! <br> <b>For Monica (NA):</b> Describe your favorite flavors and they'll craft a non-alcoholic masterpiece. <br> <b>Food:</b> Oysters & Steak Frites.",
        aviationAdj: true,
        hoochReview: { rating: 5, verdict: "Full-Body Zoomies", blurb: "Snoot-to-table cocktails; unsolicited scritches reported.", why: "bespoke sips + cozy perch" }
      },
      {
        name: "Bible Club",
        vibe: "A secret spot for the renegades who know a thing or two about finding a way into the old Ockley Green dog park. A great place for Mindy and Leah to toast to Hooch and Osho's friendship.",
        highlights: "<b>The Biblical Garden:</b> A floral, bubbly gin drink. <br> <b>For Monica (NA):</b> Their 'Temperance' section features complex NA cocktails like the 'Phony Negroni'.",
        aviationAdj: true,
        hoochReview: { rating: 4, verdict: "Big Tail Wags", blurb: "Perimeter patrol complete—patio is boop-worthy.", why: "garden vibes + NA options" }
      },
      {
        name: "Deadshot",
        vibe: "Let's see if Mindy and Keith's expert palates from roasting coffee translate to these wild cocktails! A perfect spot for the adventurous members of the dog park crew.",
        highlights: "<b>Who Is Jack Nance?:</b> A unique whiskey sour. <br> <b>For Monica (NA):</b> Ask for a 'Temperance' drink; they're known for creative NA options.",
        aviationAdj: false,
        hoochReview: { rating: 3, verdict: "Polite Sit", blurb: "Aromas do synchronized zoomies; menu leans nerdy.", why: "inventive but niche" }
      },
      {
        name: "Driftwood Room",
        vibe: "A classic, dark spot where sports-lover Aaron can probably find a TV, but will be forced to socialize instead. Perfect for the ski crew to plan their next mountain conquest.",
        highlights: "<b>Springtime in Paris:</b> Elderflower, grapefruit, bubbles. <br> <b>For Monica (NA):</b> They make a great 'French 75-ish' with sparkling cider.",
        aviationAdj: true,
        hoochReview: { rating: 4, verdict: "Big Tail Wags", blurb: "Noise is busy-brunch, not leaf-blower—dignified floof zone.", why: "classic room + floral fizz" }
      },
      {
        name: "Expatriate",
        vibe: "This place is as effortlessly cool as an all-white Husky in a snowstorm. Perfect vibes for celebrating Leah with legendary nachos to give everyone party-fuel.",
        highlights: "<b>Night Dreamer:</b> Cognac, elderflower, citrus. <br> <b>For Monica (NA):</b> Try their house-made shrubs and sodas. <br> <b>Food:</b> Expatriate Nachos are a must.",
        aviationAdj: true,
        hoochReview: { rating: 5, verdict: "Full-Body Zoomies", blurb: "Chonk-worthy nachos; good-boy gastronomy.", why: "power snacks + elderflower lift" }
      },
      {
        name: "Function NE",
        vibe: "For connoisseurs, like a dog appreciating a truly fine squeaky toy. While beer-focused, it's a great stop for the crew to try something new and noteworthy.",
        highlights: "<b>Rotating Tap List:</b> Always something new. <br> <b>For Monica (NA):</b> Usually has interesting ciders, kombuchas, or specialty sodas on tap.",
        aviationAdj: false,
        hoochReview: { rating: 3, verdict: "Polite Sit", blurb: "Tail-verified tap list; NA picks usually present.", why: "variety over vibes" }
      },
      {
        name: "Hey Love",
        vibe: "It's a tropical party in here, much like the inside of Leah's mind when she thinks about Hooch. A perfect spot for Nikita to treat the birthday girl to a fun drink!",
        highlights: "<b>Master of Karate & Friendship:</b> A frosé with rum. <br> <b>For Monica (NA):</b> Extensive NA menu, including the 'Passionfruit No-Groni'.",
        aviationAdj: false,
        hoochReview: { rating: 3, verdict: "Polite Sit", blurb: "Patio paw-lor energy; big floof vibes.", why: "fun scene; sweet-leaning" }
      },
      {
        name: "Moloko",
        vibe: "The dark, moody vibe here is perfect for Luna to blend right in... and for Linnea our teacher to finally decompress after a long week. She's definitely earned this!",
        highlights: "<b>Company Party:</b> Lavender-infused gin, lemon, bubbles. <br> <b>For Monica (NA):</b> They offer a variety of intriguing NA cocktails on their menu.",
        aviationAdj: true,
        hoochReview: { rating: 4, verdict: "Big Tail Wags", blurb: "Lavender lift earns a two-paw nod.", why: "moody nook + floral fizz" }
      },
      {
        name: "Roadside Attraction",
        vibe: "This place is so weird and wonderful, even Monica's dog Appa would be impressed. It has as much chaotic history as the Ockley Green dog park before the 'incidents'.",
        highlights: "<b>Cozy Fire Pits:</b> Great for a group hang. <br> <b>For Monica (NA):</b> Classic sodas and juices in a one-of-a-kind setting.",
        aviationAdj: false,
        hoochReview: { rating: 3, verdict: "Polite Sit", blurb: "Fire pits boost pack vibe; boop-worthy oddities.", why: "outdoor hangs, light on NA" }
      },
      {
        name: "Slammer Tavern",
        vibe: "The official after-party spot where Aaron can try ordering a round in every language he knows. No-frills, all fun, where Nikita can buy more rounds with the money saved.",
        highlights: "<b>Strong, Affordable Drinks:</b> The main event. <br> <b>For Monica (NA):</b> A solid spot for a classic soda or juice.",
        aviationAdj: false,
        hoochReview: { rating: 2, verdict: "Side-Eye Sniff", blurb: "Treats try; vibe shy—budget-friendly though.", why: "no-frills; limited NA" }
      }
    ];

    const barCoords = {
      "Angel Face":[45.5244,-122.6395],"Bible Club":[45.4741,-122.6496],"Deadshot":[45.5085,-122.6548],
      "Driftwood Room":[45.5199,-122.6872],"Expatriate":[45.5619,-122.6358],"Function NE":[45.5592,-122.6450],
      "Hey Love":[45.5229,-122.6565],"Moloko":[45.5518,-122.6766],"Roadside Attraction":[45.5152,-122.6540],
      "Slammer Tavern":[45.5186,-122.6575]
    };

    // ---- Map ----
    const map = L.map('map', { zoomControl: true }).setView([45.53, -122.65], 12.4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 20
    }).addTo(map);

    const barList = document.getElementById('bar-list');

    const cocktailIcon = L.divIcon({
      html: '<i class="fa-solid fa-martini-glass-citrus custom-marker"></i>',
      className: '', iconSize: [24,24], iconAnchor: [12,24], popupAnchor: [0,-24]
    });

    const group = L.featureGroup();
    const markersByName = new Map();
    const listItemByName = new Map();
    let activeName = null;

    const makePopupLinks = (bar) => {
      // If future canonical URLs exist on the bar object, prefer them; fall back to robust searches
      const m = bar.menuUrl || toMenuSearch(bar.name);
      const i = bar.instagramUrl || toInstaSearch(bar.name);
      const g = bar.gmapsUrl || toMaps(bar.name);
      return `
      <div class="popup-links flex flex-wrap items-center gap-3 mt-2 text-sm">
        <a target="_blank" rel="noopener" href="${m}">Menu</a>
        <span class="text-gray-400" aria-hidden="true">·</span>
        <a target="_blank" rel="noopener" href="${i}">Instagram</a>
        <span class="text-gray-400" aria-hidden="true">·</span>
        <a target="_blank" rel="noopener" href="${g}">Google Maps</a>
      </div>`;
    };

    function hoochRow(bar) {
      if (!bar.hoochReview) return '';
      return `
        <div class="mt-1 flex items-center gap-2 hooch-row">
          <img src="./hooch_critic.png" alt="Hooch the Husky — house critic" class="w-6 h-6 rounded-full ring-2 ring-[var(--rose-200)]">
          <span class="text-xs font-semibold text-gray-800">Hooch Critic:</span>
          <span class="text-xs text-gray-800">${bar.hoochReview.verdict}</span>
          <span class="text-xs">${renderPaws(bar.hoochReview.rating)}</span>
        </div>`;
    }

    function hoochMiniLine(bar) {
      if (!bar.hoochReview) return '';
      return `
        <div class="mt-1 text-[11px] text-gray-700 flex items-center gap-1">
          <img src="./hooch_critic.png" alt="" class="w-4 h-4 rounded-full ring-1 ring-[var(--rose-200)]" aria-hidden="true">
          <span class="font-medium">${bar.hoochReview.verdict}</span>
          ${renderPaws(bar.hoochReview.rating)}
        </div>`;
    }

    function setActive(name) {
      if (activeName && listItemByName.get(activeName)) {
        const prev = listItemByName.get(activeName);
        prev.setAttribute('aria-current', 'false');
      }
      const li = listItemByName.get(name);
      if (li) {
        li.setAttribute('aria-current', 'true');
        li.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      }
      activeName = name;
    }

    // Build markers + list
    bars.forEach(bar => {
      const coords = barCoords[bar.name];
      const marker = L.marker(coords, { icon: cocktailIcon }).addTo(map);
      markersByName.set(bar.name, marker);

      const popup = `
        <div>
          <div class="flex items-center gap-2">
            <h3 class="popup-title">${bar.name}</h3>
            ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>' : ''}
          </div>
          ${hoochRow(bar)}
          <p class="mt-1 text-gray-700">"${bar.vibe}"</p>
          <div class="mt-2 text-gray-800">
            <div class="popup-section-title">Highlights:</div>
            <p>${bar.highlights}</p>
          </div>
          ${bar.hoochReview ? `
            <div class="mt-2 text-gray-800 text-sm">
              <div class="popup-section-title">Haute-Take:</div>
              <p>${bar.hoochReview.blurb} <span class="italic">Snoot says:</span> return with the pack.</p>
            </div>
            <div class="text-gray-800 text-sm">
              <div class="popup-section-title">Tail Tally:</div>
              <p>${bar.hoochReview.rating}/5 🐾 — why: ${bar.hoochReview.why}.</p>
            </div>
          ` : '' }
          ${makePopupLinks(bar)}
        </div>`;
      marker.bindPopup(popup, { closeButton: true });
      group.addLayer(marker);

      // Sidebar list item with quick links + hooch verdict
      const li = document.createElement('li');
      li.className = 'p-2 rounded-lg cursor-pointer list-item';
      li.innerHTML = `
        <div class="flex items-center justify-between">
          <span class="font-semibold">${bar.name}</span>
          ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Adj.</span>' : ''}
        </div>
        ${hoochMiniLine(bar)}
        <div class="mt-1 text-xs text-gray-700">${bar.vibe}</div>
        <div class="mt-1 text-xs text-gray-700"><span class="font-semibold">Highlights:</span> ${bar.highlights}</div>
        <div class="mt-1 text-xs flex flex-wrap gap-2">
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.menuUrl || toMenuSearch(bar.name)}">Menu</a>
          <span class="text-gray-400">·</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.instagramUrl || toInstaSearch(bar.name)}">Instagram</a>
          <span class="text-gray-400">·</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.gmapsUrl || toMaps(bar.name)}">Maps</a>
        </div>
      `;
      li.setAttribute('role', 'button');
      li.setAttribute('tabindex', '0');
      li.setAttribute('aria-current', 'false');
      li.addEventListener('click', () => { map.flyTo(coords, 15, { duration: .6 }); marker.openPopup(); });
      li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.click(); }});
      barList.appendChild(li);
      listItemByName.set(bar.name, li);

      marker.on('popupopen', () => setActive(bar.name));
      marker.on('popupclose', () => {
        const current = listItemByName.get(bar.name);
        if (current) current.setAttribute('aria-current', 'false');
        if (activeName === bar.name) activeName = null;
      });
    });

    // Fit map to markers on load (good for mobile)
    map.whenReady(() => {
      if (group.getLayers().length) {
        map.fitBounds(group.getBounds().pad(0.12), { animate: false });
      }
    });
  </script>
</body>
</html>
