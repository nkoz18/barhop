<!DOCTYPE html>
<html lang="en">
<head>
  <!--
  =========================  HOOCH‚ÄôS HAUTE-TAKES ‚Äî GUIDE (not rendered)  =========================
  Section name
  Hooch‚Äôs Haute-Takes

  Image filename
  hooch_critic.png

  Paw scale (use paws as stars)
  5 üêæüêæüêæüêæüêæ ‚Äî Full-Body Zoomies: White-glove for the white floof‚Äîinstant woo-woo.
  4 üêæüêæüêæüêæ ‚Äî Big Tail Wags: Sniff-approved; one tiny grr from perfection.
  3 üêæüêæüêæ ‚Äî Polite Sit: Good dog, good grub; not a destination snout.
  2 üêæüêæ ‚Äî Side-Eye Sniff: Treats try; vibe shy.
  1 üêæ ‚Äî Low Growl: Would not boop again.
  0 ‚Äî Cone of Shame: Only if you forgot your nose at home.

  Review section headers
  Sniff Test ¬∑ Chow Down ¬∑ Pup Perks ¬∑ Pack Vibe ¬∑ Haute-Take ¬∑ Tail Tally

  Reusable voice lines / lexicon
  haute hound ‚Ä¢ fine-dining floof ‚Ä¢ snow-sommelier
  snoot-vetted ‚Ä¢ boop-worthy ‚Ä¢ sniff-approved ‚Ä¢ tail-verified
  zoomie-inducing ‚Ä¢ big floof energy ‚Ä¢ good-boy gastronomy
  patio paw-lor ‚Ä¢ water bowl sommelier ‚Ä¢ chef‚Äôs chews
  snoot-to-table ‚Ä¢ chonk-worthy portions ‚Ä¢ cold-weather cred

  Handy sentence starters
  ‚ÄúPerimeter patrol complete‚Äîpatio is boop-worthy.‚Äù
  ‚ÄúWater arrived pre-chilled; the snow-sommelier approves.‚Äù
  ‚ÄúFries pass the no-droop test; burger earns a two-paw lift.‚Äù
  ‚ÄúStaff delivered unsolicited scritches‚Äînoted.‚Äù
  ‚ÄúNoise is busy-brunch, not leaf-blower‚Äîdignified floof zone.‚Äù
  ‚ÄúAromas do synchronized zoomies: buttery grill, basil, faint fryer fizz.‚Äù

  Closers
  ‚ÄúHaute-Take: woo-woo worth the walk.‚Äù
  ‚ÄúTail Tally: X/5 üêæ ‚Äî why: one short clause.‚Äù
  ‚ÄúSnoot says: return with the pack.‚Äù
  ===============================================================================================
  -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leah's Birthday Bar Hop!</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <!-- Icons + Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root {
      --rose-700:#be123c;
      --rose-600:#e11d48; /* better contrast than pink-500 */
      --rose-500:#f43f5e;
      --rose-300:#fda4af;
      --rose-200:#fecdd3;
      --bg:#fff1f2;       /* soft rose background */
    }

    html, body { height:100%; scroll-behavior: smooth; }
    body { font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:#1f2937; }
    .birthday-header { font-family:'Pacifico', cursive; color:var(--rose-600); }

    /* Map + popups */
    #map {
      height: clamp(360px, 62vh, 640px);
      border-radius: .9rem; border:3px solid var(--rose-200);
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);
      background:#fff;
    }
    .leaflet-container a { color:var(--rose-600); }
    .leaflet-popup-content-wrapper { border-radius:.75rem; border:2px solid var(--rose-600); }
    .leaflet-popup-content {
      margin:.85rem;
      max-width:min(86vw, 392px);
      font-size:.98rem; line-height:1.5;
      font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .popup-title { font-weight:800; font-size:1.12rem; color:#111827; }
    .popup-section-title { font-weight:700; color:#111827; margin-top:.35rem; }
    .custom-marker {
      text-align:center; color:var(--rose-600); font-size:1.9rem; line-height:1;
      text-shadow:0 0 5px rgba(255,255,255,.7);
    }

    /* List items */
    .list-item { border:1px solid rgba(244,63,94,.15); }
    .list-item:hover { background:#ffe4e6; transform:translateX(3px); transition:all .15s ease-in-out; }
    .list-item[aria-current="true"] { background:#ffe4e6; border-color:var(--rose-500); box-shadow:0 0 0 2px rgba(244,63,94,.35) inset; }

    /* Confetti (subtle) */
    .confetti { position:fixed; width:10px; height:10px; opacity:.6; animation:confetti-fall 6s linear infinite;
                border-radius:50%; top:-20px; z-index:0; pointer-events:none; }
    @keyframes confetti-fall { 0%{transform:translateY(0) rotate(0)} 100%{transform:translateY(110vh) rotate(720deg)} }
    @media (prefers-reduced-motion: reduce) { .confetti { animation:none !important; display:none !important; } }

    /* Badges + links */
    .badge { display:inline-flex; align-items:center; gap:.45rem; padding:.18rem .55rem; border-radius:9999px;
             background:#ffe4e6; color:var(--rose-700); font-weight:700; font-size:.78rem; }
    .popup-links a { text-decoration:underline; }

    /* Hooch critic visuals ‚Äî icon & paws much bigger, no circular mask */
    .hooch-img { width: 92px; height:auto; display:block; }         /* larger and not rounded */
    .paws { font-size:2.8rem; line-height:1; }                      /* ~2x+ bigger */
    .paws--mini { font-size:1.9rem; line-height:1; }                /* bigger in sidebar too */

    /* Layout polish: sticky sidebar on desktop, no nested scrollbars */
    .aside-card { background:rgba(255,255,255,.9); backdrop-filter:blur(6px); }
    @media (min-width:1024px) {
      .aside-wrap { position: sticky; top: 1rem; }
    }
  </style>
</head>
<body>
  <!-- Confetti -->
  <div id="confetti-container" aria-hidden="true"></div>

  <!-- Compact top header with circular portrait -->
  <header class="container mx-auto px-4 sm:px-8 pt-6 pb-6 mb-4">
    <div class="flex flex-col sm:flex-row items-center sm:items-end gap-4 sm:gap-6">
      <!-- Circular portrait -->
      <div class="relative w-32 h-32 sm:w-40 sm:h-40 rounded-full ring-4 ring-[var(--rose-200)] shadow-lg overflow-hidden shrink-0">
        <img
          src="./leah.jpg"
          alt="Leah smiling‚Äîbirthday portrait"
          class="absolute inset-0 w-full h-full object-cover"
          loading="eager"
          onerror="this.src='https://picsum.photos/400?blur=3';"
          referrerpolicy="no-referrer"
        />
      </div>

      <div class="text-center sm:text-left">
        <div class="flex items-center justify-center sm:justify-start gap-3">
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
          <h1 class="birthday-header text-4xl sm:text-5xl">Happy Birthday, Leah!</h1>
          <i class="fa-solid fa-cake-candles text-rose-400 text-3xl"></i>
        </div>

        <p class="mt-2 text-gray-800 font-semibold">Operation: Birthday Bar Hop</p>

        <!-- ‚ú® Rewritten intro paragraph (funnier, punnier, and all floofs loved equally) -->
        <p class="text-gray-700">
          We‚Äôre raising beams <em>and</em> glasses for our favorite structural engineer
          (Michigan: built to code) with the Ockley Green renegades‚ÄîNikita, Monica, Mindy &amp; Keith, Linnea &amp; Aaron!
          The home crowd of furry friends‚ÄîHooch, Osho, Luna, and Appa‚Äîare co-captains of the cuddle league, all equally boop-worthy. üêæ
        </p>

        <!-- Plan notes (start + suggestions) -->
        <div class="mt-3 flex flex-wrap gap-2">
          <span class="badge"><i class="fa-solid fa-location-dot"></i> Tentative start: <strong>Angel Face</strong> @ <strong>7:00 pm</strong> (flexible)</span>
          <span class="badge"><i class="fa-regular fa-lightbulb"></i> These are suggestions‚Äîplease throw out options!</span>
        </div>

        <!-- Aviation quest note -->
        <div class="mt-3">
          <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-Adjacent Quest</span>
          <span class="ml-2 text-sm text-gray-700">
            Hunting gin + floral + lemon vibes (violette/elderflower) for Leah‚Äôs toast‚ÄîNA-friendly ideas welcome.
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="container mx-auto px-4 sm:px-8 pt-2 pb-10 relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 order-1">
        <div id="map" aria-label="Map of bar hop locations"></div>
        <p class="mt-2 text-xs text-gray-600">Tip: tap a marker or pick a spot from the list.</p>
      </div>

      <aside class="order-2 aside-wrap">
        <div class="aside-card p-4 rounded-xl shadow-lg border border-rose-200">
          <h2 class="text-2xl font-extrabold mb-3 border-b-2 border-rose-200 pb-2 text-[var(--rose-600)]">The Hot Spots</h2>
          <ul id="bar-list" class="space-y-2"></ul>
          <div class="mt-4 text-xs text-gray-600">
            <span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>
            picks are flagged where applicable. Links open in new tabs.
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ---- Confetti (subtle) ----
    (function () {
      const c = document.getElementById('confetti-container');
      const colors = ['#f43f5e', '#fecdd3', '#fde68a', '#a78bfa'];
      for (let i = 0; i < 50; i++) {
        const dot = document.createElement('div');
        dot.className = 'confetti';
        dot.style.left = `${Math.random() * 100}vw`;
        dot.style.animationDelay = `${Math.random() * 5}s`;
        dot.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        dot.style.transform = `scale(${Math.random() * 0.55 + 0.55})`;
        c.appendChild(dot);
      }
    })();

    // ---- Link helpers (prefer canonical; fall back to searches) ----
    const fallbackMenu = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' menu Portland')}`;
    const fallbackInsta = (name) => `https://www.google.com/search?q=${encodeURIComponent(name + ' Instagram Portland')}`;

    // ---- Accessible paws renderer (big paws) ----
    function renderPaws(rating = 0, mini = false) {
      rating = Math.max(0, Math.min(5, rating));
      const cls = mini ? 'paws paws--mini' : 'paws';
      const full = 'üêæ'.repeat(rating);
      const empty = 'üêæ'.repeat(5 - rating).split('').map(p => `<span class="opacity-30">${p}</span>`).join('');
      return `<span class="${cls}" aria-label="${rating} out of 5 paws"><span aria-hidden="true">${full}${empty}</span></span>`;
    }

    // ---- Bars (updated with explicit CSV highlights for drinks/NA/food) ----
    const bars = [
      {
        name: "Angel Face",
        vibe: "European-style, intimate, alluring‚Äîdescribe your flavors and they‚Äôll engineer it. Perfect place to ‚Äòspec and sip‚Äô.",
        lat: 45.5232, lng: -122.6371,
        instagramUrl: "https://www.instagram.com/angelfaceportland/",
        menuUrl: "https://www.angelfaceportland.com/pages/menu",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=14+NE+28th+Ave,+Portland,+OR+97232",
        distanceMi: 3.4,
        aviationAdj: true,
        highlightedDrink: "Dealer's Choice (Bespoke)",
        highlightedNADrink: "Dealer's Choice (Custom)",
        highlightedFood: "Steak Tartare with Oysters",
        hoochReview: {
          rating: 5, verdict: "Full-Body Zoomies",
          sniff: "Juniper, floral whispers, bright citrus‚Äîclean as fresh snow.",
          chow: "Steak tartare plays wing-pup to oysters‚Äîelegant and chonk-worthy.",
          perks: "NA bespoke drinks on request; water arrives pre-chilled.",
          vibe: "Hand-painted room; quiet conversations.",
          haute: "Dealer‚Äôs choice here really means choice.",
          why: "bespoke magic + cozy seats"
        }
      },
      {
        name: "Deadshot",
        vibe: "Avant-garde cocktail lab‚Äîwhere flavor science meets fun. Great for a group ‚Äòsip-posium‚Äô.",
        lat: 45.5074, lng: -122.6548,
        instagramUrl: "https://www.instagram.com/deadshotpdx/",
        menuUrl: "https://www.deadshotpdx.com/menu",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=2133+SE+11th+Ave,+Portland,+OR+97214",
        distanceMi: 4.2,
        aviationAdj: false,
        highlightedDrink: "Blood Orange Gimlet",
        highlightedNADrink: "Tropic Noir",
        highlightedFood: "French Onion Brie Burger",
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Bitters, citrus, and a little mad-scientist energy.",
          chow: "French Onion Brie Burger = burger-and-beakers bliss.",
          perks: "Zero-proof riffs like Tropic Noir.",
          vibe: "Cocktail nerd HQ; Aaron can order in multiple languages.",
          haute: "Bring curiosity; leave dogma.",
          why: "inventive but niche"
        }
      },
      {
        name: "Driftwood Room",
        vibe: "1950s hotel lounge‚Äîmoody and glamorous; perfect for plotting winter-sports shenanigans.",
        lat: 45.5208, lng: -122.6878,
        instagramUrl: "https://www.instagram.com/hotel_deluxe/",
        menuUrl: "https://www.hoteldeluxe.com/dining/driftwood-room/driftwood-menu/",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=729+SW+15th+Ave,+Portland,+OR+97205",
        distanceMi: 3.3,
        aviationAdj: true,
        highlightedDrink: "Marigolds & Daffodils",
        highlightedNADrink: "Calypso's Song",
        highlightedFood: "Driftwood Burger (Wagyu)",
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Grapefruit and elderflower‚Äîbright and spritzy.",
          chow: "Wagyu Driftwood Burger‚Äîclassic, plush, and well-structured.",
          perks: "Thoughtful NA list (try Calypso‚Äôs Song).",
          vibe: "Dim, plush, relaxed.",
          haute: "Old-Hollywood vibe without the drama.",
          why: "floral fizz + comfy booths"
        }
      },
      {
        name: "Expatriate",
        vibe: "Atmospheric with balanced cocktails and craveable snacks; playlist begs for one more round.",
        lat: 45.5624, lng: -122.6346,
        instagramUrl: "https://www.instagram.com/expatriatepdx/",
        menuUrl: "http://expatriatepdx.com/cocktails",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=5424+NE+30th+Avenue,+Portland,+OR+97211",
        distanceMi: 2.2,
        aviationAdj: true,
        highlightedDrink: "Starling",
        highlightedNADrink: "Dealer's Choice (Custom)",
        highlightedFood: "Expatriate Nacho",
        hoochReview: {
          rating: 5, verdict: "Full-Body Zoomies",
          sniff: "Citrus and spice with just-right balance.",
          chow: "Expatriate Nacho = power snack for the pack.",
          perks: "House shrubs/sodas or NA dealer‚Äôs choice.",
          vibe: "Dim, lively, playlist on point.",
          haute: "High hit rate on both food and drinks.",
          why: "power snacks + floral notes"
        }
      },
      {
        name: "Function NE",
        vibe: "Rotating brewery pop-ups‚Äîperfect for sampler flights and casual catch-ups.",
        lat: 45.5590, lng: -122.6448,
        instagramUrl: "https://www.instagram.com/functionpdx/",
        menuUrl: "https://untappd.com/v/function-ne/12485099",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=2006+NE+Alberta+St,+Portland,+OR+97211",
        distanceMi: 1.7,
        aviationAdj: false,
        highlightedDrink: "N/A (Beer-focused)",
        highlightedNADrink: "Standard Sodas",
        highlightedFood: "N/A (Outside food welcome)",
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Fresh hops; occasional cider cameo.",
          chow: "Outside food welcome‚Äîsnack strategy is yours.",
          perks: "Usually cider/kombucha/NA cans or sodas.",
          vibe: "Alberta energy; easy to mingle.",
          haute: "Great for beer explorers.",
          why: "rotating taps + options"
        }
      },
      {
        name: "Hey Love",
        vibe: "Plant-filled ‚Äòindoor jungle‚Äô with tropical vibes and fun slushies‚Äîa mini vacation downtown.",
        lat: 45.5228, lng: -122.6562,
        instagramUrl: "https://www.instagram.com/heylovepdx/",
        menuUrl: "https://www.heylovepdx.com/dinner",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=920+E+Burnside+St,+Portland,+OR+97214",
        distanceMi: 3.2,
        aviationAdj: false,
        highlightedDrink: "Clover Club G & T",
        highlightedNADrink: "Rose City Swizzle",
        highlightedFood: "JOJOS! (Crispy Fried Potato Wedges)",
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Fruit, herbs, sunshine-adjacent.",
          chow: "JOJOS!‚Äîpeak wedge-funded joy.",
          perks: "Robust NA list‚Äîstart with Rose City Swizzle.",
          vibe: "Colorful, lively, very ‚ÄòPortland‚Äô.",
          haute: "Mood booster; easy crowd-pleaser.",
          why: "playful menu; sweet-leaning"
        }
      },
      {
        name: "Moloko",
        vibe: "Coral-reef aquariums meet cozy modern nook‚Äîneon-tinted decompression zone.",
        lat: 45.5518, lng: -122.6763,
        instagramUrl: "https://www.instagram.com/molokopdx/",
        menuUrl: "https://www.molokopdx.com/menu-page",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=3967+N+Mississippi+Ave,+Portland,+OR+97227",
        distanceMi: 1.1,
        aviationAdj: true,
        highlightedDrink: "Company Party",
        highlightedNADrink: "Madame Shirley",
        highlightedFood: "Margherita Pizza",
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Lavender and lemon with bubbles.",
          chow: "Margherita Pizza for shared slices and smiles.",
          perks: "NA cocktails like the Madame Shirley.",
          vibe: "Purple glow; relaxed patio when open.",
          haute: "Comfy nook with personality.",
          why: "floral spritz + hideaway"
        }
      },
      {
        name: "Roadside Attraction",
        vibe: "Quirky, cash-only time capsule with a great fire-pit patio‚Äîmaximum ‚Äòkeep Portland weird‚Äô.",
        lat: 45.5160, lng: -122.6535,
        instagramUrl: "https://www.instagram.com/roadsideattractionpdx/",
        menuUrl: "http://places.singleplatform.com/roadside-attraction/menu",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=1000+SE+12th+Ave,+Portland,+OR+97214",
        distanceMi: 3.6,
        aviationAdj: false,
        highlightedDrink: "N/A (Dive Bar)",
        highlightedNADrink: "Standard Sodas",
        highlightedFood: "French Dip Sandwich",
        hoochReview: {
          rating: 3, verdict: "Polite Sit",
          sniff: "Campfire, citrus, a little fryer sizzle.",
          chow: "French dip and friends‚Äîsimple, satisfying.",
          perks: "Sodas & low-key sips for NA.",
          vibe: "Eclectic patio; story-fuel for days.",
          haute: "Bring cash and a sense of humor.",
          why: "fire pits + quirks"
        }
      },
      {
        name: "Slammer Tavern",
        vibe: "Old-school dive with strong pours, string lights, and a friendly crowd‚Äîwallet-friendly after-party.",
        lat: 45.5191, lng: -122.6574,
        instagramUrl: "https://www.instagram.com/slammertavern/",
        menuUrl: "http://places.singleplatform.com/slammers-16/menu",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=500+SE+8th+Ave,+Portland,+OR+97214",
        distanceMi: 3.4,
        aviationAdj: false,
        highlightedDrink: "N/A (Dive Bar)",
        highlightedNADrink: "Standard Sodas",
        highlightedFood: "Super Chili Dog",
        hoochReview: {
          rating: 2, verdict: "Side-Eye Sniff",
          sniff: "Jukebox nostalgia and peanuts.",
          chow: "Super Chili Dog = messy legend.",
          perks: "Sodas and tallboys for the NA crew.",
          vibe: "Zero pretense; maximum stories.",
          haute: "Fun stop if expectations are set.",
          why: "cheap & cheerful; limited NA"
        }
      },
      {
        name: "Scotch Lodge",
        vibe: "Vintage-chic whiskey den with half-pours for exploration‚Äî‚Äòsampling protocol‚Äô encouraged.",
        lat: 45.5214, lng: -122.6569,
        instagramUrl: "https://www.instagram.com/scotchlodge/",
        menuUrl: "https://www.scotchlodge.com/menus",
        gmapsUrl: "https://www.google.com/maps/search/?api=1&query=215+SE+9th+Ave+Ste+102,+Portland,+OR+97214",
        distanceMi: 3.2,
        aviationAdj: false,
        highlightedDrink: "Dealer's Choice (Inferred)",
        highlightedNADrink: "Fentimans Ginger Beer",
        highlightedFood: "Dashi Arancini",
        hoochReview: {
          rating: 4, verdict: "Big Tail Wags",
          sniff: "Oak, honey, citrus‚Äîbalanced and thoughtful.",
          chow: "Dashi Arancini keeps pace with pours.",
          perks: "NA pick: Fentimans Ginger Beer.",
          vibe: "Quiet flex; date-night friendly.",
          haute: "For the ‚Äòlet‚Äôs try one more‚Äô crowd.",
          why: "excellent pours + calm vibe"
        }
      }
    ];

    // ---- Map ----
    const map = L.map('map', { zoomControl: true }).setView([45.53, -122.65], 12.4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 20
    }).addTo(map);

    const barList = document.getElementById('bar-list');
    const group = L.featureGroup();
    const listItemByName = new Map();
    let activeName = null;

    const cocktailIcon = L.divIcon({
      html: '<i class="fa-solid fa-martini-glass-citrus custom-marker"></i>',
      className: '', iconSize: [24,24], iconAnchor: [12,24], popupAnchor: [0,-24]
    });

    const makePopupLinks = (bar) => {
      const m = bar.menuUrl || fallbackMenu(bar.name);
      const i = bar.instagramUrl || fallbackInsta(bar.name);
      const g = bar.gmapsUrl;
      return `
      <div class="popup-links flex flex-wrap items-center gap-3 mt-2 text-sm">
        <a target="_blank" rel="noopener" href="${m}">Menu</a>
        <span class="text-gray-400" aria-hidden="true">¬∑</span>
        <a target="_blank" rel="noopener" href="${i}">Instagram</a>
        <span class="text-gray-400" aria-hidden="true">¬∑</span>
        <a target="_blank" rel="noopener" href="${g}">Google Maps</a>
      </div>`;
    };

    // Build Hooch‚Äôs Haute-Takes section for a popup (big icon, big paws, no circle)
    function hoochSection(bar) {
      const r = bar.hoochReview;
      if (!r) return '';
      return `
        <div class="mt-3">
          <div class="popup-section-title flex items-center gap-3">
            <span class="hooch-icon inline-flex items-center justify-center">
              <img src="./hooch_critic.png" alt="Hooch the Husky ‚Äî house critic" class="hooch-img">
            </span>
            <span>Hooch‚Äôs Haute-Takes</span>
            <span class="ml-auto text-sm font-semibold text-gray-800">${r.verdict}</span>
            ${renderPaws(r.rating, false)}
          </div>
          <div class="mt-1 text-sm text-gray-800 leading-5">
            <div><span class="font-semibold">Sniff Test:</span> ${r.sniff}</div>
            <div><span class="font-semibold">Chow Down:</span> ${r.chow}</div>
            <div><span class="font-semibold">Pup Perks:</span> ${r.perks}</div>
            <div><span class="font-semibold">Pack Vibe:</span> ${r.vibe}</div>
            <div><span class="font-semibold">Haute-Take:</span> ${r.haute}</div>
            <div><span class="font-semibold">Tail Tally:</span> ${r.rating}/5 üêæ ‚Äî why: ${r.why}.</div>
          </div>
        </div>`;
    }

    function highlightsSection(bar) {
      return `
        <div class="mt-2 text-gray-800">
          <div class="popup-section-title">Spotlight Sips &amp; Bites</div>
          <ul class="mt-1 text-sm leading-6">
            <li><span class="font-semibold">Drink:</span> ${bar.highlightedDrink}</li>
            <li><span class="font-semibold">NA:</span> ${bar.highlightedNADrink}</li>
            <li><span class="font-semibold">Food:</span> ${bar.highlightedFood}</li>
          </ul>
        </div>`;
    }

    function hoochMiniLine(bar) {
      if (!bar.hoochReview) return '';
      return `
        <div class="mt-1 text-[12.5px] text-gray-700 flex items-center gap-2">
          <img src="./hooch_critic.png" alt="Hooch the Husky ‚Äî house critic" class="" style="width:38px;height:auto;">
          <span class="font-medium">${bar.hoochReview.verdict}</span>
          ${renderPaws(bar.hoochReview.rating, true)}
        </div>`;
    }

    function setActive(name) {
      if (activeName && listItemByName.get(activeName)) {
        listItemByName.get(activeName).setAttribute('aria-current','false');
      }
      const li = listItemByName.get(name);
      if (li) {
        li.setAttribute('aria-current','true');
        li.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      }
      activeName = name;
    }

    // Render markers + sidebar list
    bars.forEach(bar => {
      const coords = [bar.lat, bar.lng];
      const marker = L.marker(coords, { icon: cocktailIcon }).addTo(map);

      const popup = `
        <div>
          <div class="flex items-center gap-2">
            <h3 class="popup-title">${bar.name}</h3>
            ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Aviation-adjacent</span>' : ''}
          </div>

          <p class="mt-1 text-gray-700">${bar.vibe}</p>

          ${highlightsSection(bar)}
          ${hoochSection(bar)}

          <div class="mt-2 text-gray-800">
            <div class="popup-section-title">Links</div>
            ${makePopupLinks(bar)}
          </div>
        </div>`;
      marker.bindPopup(popup, { closeButton: true });
      group.addLayer(marker);

      // Sidebar list item
      const li = document.createElement('li');
      li.className = 'p-3 rounded-lg cursor-pointer list-item';
      li.innerHTML = `
        <div class="flex items-center justify-between">
          <span class="font-semibold">${bar.name}</span>
          <div class="flex items-center gap-2">
            ${bar.aviationAdj ? '<span class="badge"><i class="fa-solid fa-plane-departure"></i> Adj.</span>' : ''}
            <span class="text-[11px] text-gray-600">~${bar.distanceMi} mi from Ockley Green</span>
          </div>
        </div>
        ${hoochMiniLine(bar)}
        <div class="mt-1 text-xs text-gray-700">${bar.vibe}</div>
        <div class="mt-1 text-[11.5px] text-gray-800">
          <span class="font-semibold">Drink:</span> ${bar.highlightedDrink} &nbsp;‚Ä¢&nbsp;
          <span class="font-semibold">NA:</span> ${bar.highlightedNADrink} &nbsp;‚Ä¢&nbsp;
          <span class="font-semibold">Food:</span> ${bar.highlightedFood}
        </div>
        <div class="mt-2 text-xs flex flex-wrap gap-2">
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.menuUrl || fallbackMenu(bar.name)}">Menu</a>
          <span class="text-gray-400">¬∑</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.instagramUrl || fallbackInsta(bar.name)}">Instagram</a>
          <span class="text-gray-400">¬∑</span>
          <a class="underline text-[var(--rose-600)]" target="_blank" rel="noopener" href="${bar.gmapsUrl}">Maps</a>
        </div>
      `;
      li.setAttribute('role','button');
      li.setAttribute('tabindex','0');
      li.setAttribute('aria-current','false');
      li.addEventListener('click', () => { map.flyTo(coords, 15, { duration:.6 }); marker.openPopup(); });
      li.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.click(); }});
      barList.appendChild(li);
      listItemByName.set(bar.name, li);

      marker.on('popupopen', () => setActive(bar.name));
      marker.on('popupclose', () => {
        const current = listItemByName.get(bar.name);
        if (current) current.setAttribute('aria-current','false');
        if (activeName === bar.name) activeName = null;
      });
    });

    // Fit map to markers on load (good for mobile)
    map.whenReady(() => {
      if (group.getLayers().length) {
        map.fitBounds(group.getBounds().pad(0.12), { animate:false });
      }
    });
  </script>
</body>
</html>
